use Test::More;

my $TESTS = [
  [1, 1, "1\n"],
  [
    '1',
    '10',
    '1
2
3
4
5
6
7
8
9
10
'
  ],
  [
    '10',
    '1',
    '1 2 3 4 5 6 7 8 9 10
'
  ],
  [
    '10',
    '3',
  '1  2  3  4  5  6  7  8  9  10
22 23 24 25 26 27 28 29 30 11
21 20 19 18 17 16 15 14 13 12
'
  ],
  [
    '3',
    '10',
    '1  2  3
22 23 4
21 24 5
20 25 6
19 26 7
18 27 8
17 28 9
16 29 10
15 30 11
14 13 12
'
  ],
  [
    '4',
    '4',
    '1  2  3  4
12 13 14 5
11 16 15 6
10 9  8  7
'
  ],
  [
    '15',
    '15',
    '1  2   3   4   5   6   7   8   9   10  11  12  13  14 15
56 57  58  59  60  61  62  63  64  65  66  67  68  69 16
55 104 105 106 107 108 109 110 111 112 113 114 115 70 17
54 103 144 145 146 147 148 149 150 151 152 153 116 71 18
53 102 143 176 177 178 179 180 181 182 183 154 117 72 19
52 101 142 175 200 201 202 203 204 205 184 155 118 73 20
51 100 141 174 199 216 217 218 219 206 185 156 119 74 21
50 99  140 173 198 215 224 225 220 207 186 157 120 75 22
49 98  139 172 197 214 223 222 221 208 187 158 121 76 23
48 97  138 171 196 213 212 211 210 209 188 159 122 77 24
47 96  137 170 195 194 193 192 191 190 189 160 123 78 25
46 95  136 169 168 167 166 165 164 163 162 161 124 79 26
45 94  135 134 133 132 131 130 129 128 127 126 125 80 27
44 93  92  91  90  89  88  87  86  85  84  83  82  81 28
43 42  41  40  39  38  37  36  35  34  33  32  31  30 29
'
  ],
  [
    '20',
    '50',
    '1   2   3   4   5   6   7   8   9   10   11  12  13  14  15  16  17  18  19  20
136 137 138 139 140 141 142 143 144 145  146 147 148 149 150 151 152 153 154 21
135 264 265 266 267 268 269 270 271 272  273 274 275 276 277 278 279 280 155 22
134 263 384 385 386 387 388 389 390 391  392 393 394 395 396 397 398 281 156 23
133 262 383 496 497 498 499 500 501 502  503 504 505 506 507 508 399 282 157 24
132 261 382 495 600 601 602 603 604 605  606 607 608 609 610 509 400 283 158 25
131 260 381 494 599 696 697 698 699 700  701 702 703 704 611 510 401 284 159 26
130 259 380 493 598 695 784 785 786 787  788 789 790 705 612 511 402 285 160 27
129 258 379 492 597 694 783 864 865 866  867 868 791 706 613 512 403 286 161 28
128 257 378 491 596 693 782 863 936 937  938 869 792 707 614 513 404 287 162 29
127 256 377 490 595 692 781 862 935 1000 939 870 793 708 615 514 405 288 163 30
126 255 376 489 594 691 780 861 934 999  940 871 794 709 616 515 406 289 164 31
125 254 375 488 593 690 779 860 933 998  941 872 795 710 617 516 407 290 165 32
124 253 374 487 592 689 778 859 932 997  942 873 796 711 618 517 408 291 166 33
123 252 373 486 591 688 777 858 931 996  943 874 797 712 619 518 409 292 167 34
122 251 372 485 590 687 776 857 930 995  944 875 798 713 620 519 410 293 168 35
121 250 371 484 589 686 775 856 929 994  945 876 799 714 621 520 411 294 169 36
120 249 370 483 588 685 774 855 928 993  946 877 800 715 622 521 412 295 170 37
119 248 369 482 587 684 773 854 927 992  947 878 801 716 623 522 413 296 171 38
118 247 368 481 586 683 772 853 926 991  948 879 802 717 624 523 414 297 172 39
117 246 367 480 585 682 771 852 925 990  949 880 803 718 625 524 415 298 173 40
116 245 366 479 584 681 770 851 924 989  950 881 804 719 626 525 416 299 174 41
115 244 365 478 583 680 769 850 923 988  951 882 805 720 627 526 417 300 175 42
114 243 364 477 582 679 768 849 922 987  952 883 806 721 628 527 418 301 176 43
113 242 363 476 581 678 767 848 921 986  953 884 807 722 629 528 419 302 177 44
112 241 362 475 580 677 766 847 920 985  954 885 808 723 630 529 420 303 178 45
111 240 361 474 579 676 765 846 919 984  955 886 809 724 631 530 421 304 179 46
110 239 360 473 578 675 764 845 918 983  956 887 810 725 632 531 422 305 180 47
109 238 359 472 577 674 763 844 917 982  957 888 811 726 633 532 423 306 181 48
108 237 358 471 576 673 762 843 916 981  958 889 812 727 634 533 424 307 182 49
107 236 357 470 575 672 761 842 915 980  959 890 813 728 635 534 425 308 183 50
106 235 356 469 574 671 760 841 914 979  960 891 814 729 636 535 426 309 184 51
105 234 355 468 573 670 759 840 913 978  961 892 815 730 637 536 427 310 185 52
104 233 354 467 572 669 758 839 912 977  962 893 816 731 638 537 428 311 186 53
103 232 353 466 571 668 757 838 911 976  963 894 817 732 639 538 429 312 187 54
102 231 352 465 570 667 756 837 910 975  964 895 818 733 640 539 430 313 188 55
101 230 351 464 569 666 755 836 909 974  965 896 819 734 641 540 431 314 189 56
100 229 350 463 568 665 754 835 908 973  966 897 820 735 642 541 432 315 190 57
99  228 349 462 567 664 753 834 907 972  967 898 821 736 643 542 433 316 191 58
98  227 348 461 566 663 752 833 906 971  968 899 822 737 644 543 434 317 192 59
97  226 347 460 565 662 751 832 905 970  969 900 823 738 645 544 435 318 193 60
96  225 346 459 564 661 750 831 904 903  902 901 824 739 646 545 436 319 194 61
95  224 345 458 563 660 749 830 829 828  827 826 825 740 647 546 437 320 195 62
94  223 344 457 562 659 748 747 746 745  744 743 742 741 648 547 438 321 196 63
93  222 343 456 561 658 657 656 655 654  653 652 651 650 649 548 439 322 197 64
92  221 342 455 560 559 558 557 556 555  554 553 552 551 550 549 440 323 198 65
91  220 341 454 453 452 451 450 449 448  447 446 445 444 443 442 441 324 199 66
90  219 340 339 338 337 336 335 334 333  332 331 330 329 328 327 326 325 200 67
89  218 217 216 215 214 213 212 211 210  209 208 207 206 205 204 203 202 201 68
88  87  86  85  84  83  82  81  80  79   78  77  76  75  74  73  72  71  70  69
'
  ]
];

my $script_to_test = shift;
my $tests_count = 0;

sub test_script {
  my ($script) = @_;

  foreach my $test (@{$TESTS}) {
    my ($width, $height, $expected_output) = @{$test};

    my $output = `solutions/$script $width $height`;

    is($output, $expected_output, "$script: width=$width, height=$height");
    $tests_count++;
  }}

if (defined $script_to_test) {
  test_script($script_to_test);
}
else {
  opendir(my $solutions_dir, 'solutions') or die "Can't open solutions/: $!";
  while (my $script = readdir($solutions_dir)) {
    next unless $script =~ /[.]pl$/;
    test_script($script);
  }
}

done_testing($tests_count);
